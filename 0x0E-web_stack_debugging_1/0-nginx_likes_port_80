#!/usr/bin/env bash
# This script configures Nginx to listen on port 80 of all active IPv4 IPs

# Update package lists and ensure Nginx is installed
apt-get update -y && apt-get install -y nginx

# Configure Nginx to listen on port 80 (default configuration already listens on port 80)
# Just ensure it's correctly set up and restart the service
sed -i '/^#*listen 80;/c\listen 80;' /etc/nginx/sites-available/default

# Ensure the default Nginx configuration is enabled
ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/

# Start and enable Nginx to run on boot
systemctl restart nginx
systemctl enable nginx

# Verify Nginx is running
if systemctl status nginx | grep -q "active (running)"; then
  echo "Nginx is running and configured to listen on port 80"
else
  echo "Failed to start Nginx"
  exit 1
fi
